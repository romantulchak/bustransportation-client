<section>
  <h3>Create trip</h3>
  <form action="" [formGroup]="tripForm">
    <div>
      <label for="bus">Select bus</label>
      <select formControlName="bus" name="bus" id="bus">
        <option></option>
        <option *ngFor="let bus of buses" [ngValue]="bus">{{bus.name}}</option>
      </select>
    </div>

    <div>
      <label for="name">Name</label>
      <input type="text" formControlName="name" id="name" required>
    </div>
    <div *ngIf="bus != null">
      <label for="numberOfSeats">Number of Seats</label>
      <input type="number" formControlName="numberOfSeats" id="numberOfSeats" [(ngModel)]="bus.numberOfSeats" required>
    </div>
    <div>
      <label for="tripType">Trip type</label>
      <select name="tripType" id="tripType" formControlName="tripType">
        <option [value]="'REGULAR'">REGULAR</option>
        <option [value]="'IRREGULAR'">IRREGULAR</option>
      </select>
    </div>

    <div [formArrayName]="'stops'">
      <h3>Intermediate Places</h3>
      <div class="intermediate__places">
        <ng-container
          *ngFor="let intermediatePlace of stops.controls;let i = index; let last = last; let first = first">
          <div [formGroupName]="i">
            <div class="intermediate__place_card">
              <h3 *ngIf="first">From {{name(i)}}</h3>
              <h3 *ngIf="last && stops.length >= 2">To {{name(i)}}</h3>

              <div>
                <label for="name-{{i}">City</label>
                <input type="text" id="name-{{i}" formControlName="name" required>
              </div>
              <div>
                <label for="departure-{{i}}">Date of departure</label>
                <input type="datetime-local" id="departure-{{i}}" required formControlName="departure">
              </div>
              <div *ngIf="!first">
                <label for="price-{{i}}">Price</label>
                <input type="number" id="price-{{i}}" formControlName="price" required>
              </div>
              <div>
                <label for="street-{{i}}">Street</label>
                <input type="text" formControlName="street" id="street-{{i}}" required>
              </div>
              <div>
                <label for="isBusStop-{{i}}">Bus stop</label>
                <input type="checkbox" formControlName="isBusStop" [attr.disabled]="first || last ? '' : null"
                       [checked]="isBusStop(i)" id="isBusStop-{{i}}">
              </div>
              <h2>{{first}}</h2>
              <button (click)="removeIntermediatePlace(i)">Remove</button>
            </div>
          </div>
        </ng-container>
      </div>
      <button (click)="addIntermediatePlace()">Add</button>
    </div>
    <button title="{{stops.length < 2 ? 'Number of stops less than 2' : 'Create'}}" [disabled]="stops.length < 2"
            (click)="create()">Create
    </button>
  </form>
  <pre>{{tripForm.value | json}}</pre>
</section>
